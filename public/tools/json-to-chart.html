<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JSON to Chart Tool</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background: #f9f9f9;
    }
    textarea {
      width: 100%;
      height: 200px;
      font-family: monospace;
      margin-bottom: 15px;
      border-radius: 8px;
      padding: 10px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      background: #4CAF50;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }
    canvas {
      margin-top: 20px;
      background: white;
      border-radius: 8px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h2>ðŸ“ˆ JSON to Chart Tool</h2>
  <p>Paste your JSON data below, then click <b>Generate Chart</b>:</p>

  <textarea id="jsonInput" placeholder="Paste your JSON here..."></textarea>
  <br>
  <button onclick="generateChart()">Generate Chart</button>

  <canvas id="myChart" height="100"></canvas>

  <script>
    let chart; // global chart reference

    function generateChart() {
      const input = document.getElementById('jsonInput').value.trim();
      if (!input) return alert("Please paste JSON data!");

      let data;
      try {
        data = JSON.parse(input);
      } catch (e) {
        alert("Invalid JSON format!");
        return;
      }

      // Example: {"Pm10": [{ "ts": 1760932962487, "value": "0.0" }, ...]}
      const key = Object.keys(data)[0];
      const records = data[key];

      if (!records || !Array.isArray(records)) {
        alert("Invalid format â€” expected { 'Key': [ { ts, value }, ... ] }");
        return;
      }

      const labels = records.map(r => new Date(r.ts).toLocaleString());
      const values = records.map(r => parseFloat(r.value));

      const ctx = document.getElementById('myChart').getContext('2d');

      // Destroy old chart if exists
      if (chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [{
            label: key,
            data: values,
            borderColor: '#007bff',
            backgroundColor: 'rgba(0, 123, 255, 0.2)',
            pointRadius: 2,
            borderWidth: 2,
            tension: 0.2
          }]
        },
        options: {
          responsive: true,
          scales: {
            x: {
              title: { display: true, text: 'Timestamp' },
              ticks: { maxRotation: 45, minRotation: 45 }
            },
            y: {
              title: { display: true, text: 'Value' },
              beginAtZero: true
            }
          },
          plugins: {
            legend: { position: 'top' },
            title: {
              display: true,
              text: 'Sensor Data Chart'
            },
            tooltip: {
              callbacks: {
                label: context => `Value: ${context.formattedValue}`
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
